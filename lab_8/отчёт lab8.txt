Лабораторная работа 8
Выполнила Чикомазова Алиса Р-3122


Целью работы являлась разработка простого сайта, реализующего принципы архитектуры Model-View-Controller (MVC). В ходе работы были решены следующие задачи:

  Определение моделей предметной области (Пользователь, Валюта, Подписка).
  Создание базового HTTP-сервера с использованием http.server (контроллер).
  Реализация маршрутизации GET-запросов.
  Интеграция шаблонизатора Jinja2 для динамического отображения данных (представление).
  Интеграция с внешним API (ЦБ РФ) для получения актуальных курсов валют.
  Обработка статических файлов.

Предметная область описывает пользователей приложения и валюты, на которые они могут быть подписаны.

Модели:

1.  Author (models/author.py):
      Свойства: name (имя автора), group (номер группы).
      Связи: Отдельная модель для метаинформации о приложении.
2.  App (models/app.py):
      Свойства: name (название приложения), version (версия), author (объект Author).
      Связи: с Author.
3.  User (models/user.py):
      Свойства: id (уникальный ID), name (имя пользователя).
      Связи: с UserCurrency.
4.  Currency (models/currency.py):
      Свойства: currency_id, num_code, char_code, nominal, name, value
      Связи: с UserCurrency.
5.  UserCurrency (models/user_currency.py):
      Свойства: user (объект User), currency (объект Currency), id (ID подписки).
      Связи: Связующая модель между User и Currency, реализующая концепцию подписки.

Cтруктура проекта

Проект организован в виде модульной структуры для разделения логики согласно принципам MVC.

'models/'     | Модели (Model): Содержит классы, описывающие сущности и их бизнес-логику ('Author', 'User', 'Currency', 'UserCurrency', 'App'). 
'static/css/' | Статические файлы (View): Содержит файл 'style.css' для оформления. 
'templates/'  | Шаблоны: Содержит HTML-шаблоны Jinja2 ('index.html', 'users.html', 'base.html', и т.д.) для отображения. 
'utils/'      | Вспомогательные утилиты: Содержит 'currencies_api.py' для работы с внешним API курсов валют. 
'myapp.py'    | Контроллер: Реализует 'SimpleHTTPController', маршрутизацию и логику обработки запросов. 
'tests.py'    | Тестирование: Содержит юнит-тесты для моделей и утилит. 



Описание реализации

1. Реализация моделей и их свойств

Модели реализованы как классы с явными геттерами и сеттерами с использованием декоратора @property и сеттера @attribute.setter. 
Пример (models/author.py):

class Author:
    def __init__(self, name: str, group: str):
        self._name = self._validate_name(name)
        self._group = self._validate_group(group)

    # Геттер
    @property
    def name(self) -> str:
        return self._name

    # Сеттер с валидацией
    @name.setter
    def name(self, value: str):
        self._name = self._validate_name(value)

    ...

Валидация включает проверку типов (TypeError) и содержимого (например, пустая строка или некорректный формат для ID). 


2. Реализация маршрутов и обработка запросов

Обработка запросов и маршрутизация реализованы в классе SimpleHTTPController, который наследуется от BaseHTTPRequestHandler.

  Метод 'do_GET' парсит URL с помощью 'urlparse' и 'parse_qs'
  На основе полученного пути происходит маршрутизация на соответствующие методы-обработчики handle_index, handle_users, handle_currencies, и т.д.
  Для запроса '/user' используется параметр 'id' из 'query_params' для получения детальной информации о конкретном пользователе.
  Запросы, начинающиеся с '/static/', обрабатываются отдельно методом 'handle_static_file' для отдачи CSS-файлов.

3. Использование шаблонизатора Jinja2

Jinja2 используется для создания динамического HTML-контента.

  Рендеринг:
    Метод _render_and_send в контроллере принимает объект шаблона и словарь 'context' с данными.

    html_content = template.render(**context)

4. Интеграция функции get_currencies

Функция get_currencies инкапсулирует логику обращения к внешнему API ЦБ РФ.

  Она выполняет HTTP-запрос с помощью библиотеки requests.
  Полученный XML-ответ парсится с помощью модуля xml.etree.ElementTree.
  Каждый элемент <Valute> преобразуется в объект Currency.
  Функция вызывается при старте сервера в setup_initial_data() для первичной загрузки, а также в обработчике /currencies для получения актуальных данных.

Тестирование

Тестирование реализовано в файле tests.py с использованием стандартного модуля unittest.

